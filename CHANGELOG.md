# 更新日志

## v1.7.2 (2025-12-08)

### ✨ 本次更新

- 新增危险操作二次确认与静默模式开关，统一弹窗文案并按操作动态生成提示。
- 全局清理操作支持静默执行，避免频繁弹窗。

## v1.7.1 (2025-11-15)

### 🎨 UI/UX 优化

- **语言设置和主题切换位置优化** - 将语言设置和主题切换功能移至顶部右上角

  - 语言设置从"高级设置"标签页移至 header 右上角，使用图标按钮（文<sub>A</sub>）
  - 主题切换从"高级设置"标签页移至 header 右上角，使用调色板图标
  - 两个按钮并排显示，使用 fixed 定位，始终可见
  - 统一按钮大小为 32px × 32px，保持视觉一致性
  - 优化下拉菜单样式，使用固定定位和动态计算位置
  - 添加浅色主题兼容样式，确保在不同主题下都能正常显示
  - 提升用户体验，无需进入设置页面即可快速切换语言和主题

- **Header 区域优化** - 优化 header 布局和高度
  - 调整 header padding 和 min-height，减少整体高度
  - 优化标题和版本号的字体大小和间距
  - 添加 padding-right 防止标题文本与右上角按钮重叠
  - 优化响应式设计，小屏幕下自动调整按钮位置和大小

### 🐛 问题修复

- **修复版本号显示问题** - 解决版本号显示"加载中..."的问题

  - 移除内联脚本，避免 CSP (Content Security Policy) 违规
  - 将版本号加载逻辑移至 popup.js 模块中
  - 使用 requestAnimationFrame 确保 DOM 已准备好
  - 版本号现在从 manifest.json 自动读取，无需手动更新多个位置

- **修复 StatusManager 显示问题** - 优化状态消息容器的显示
  - 移除状态消息的 margin-bottom，消除底部空白
  - 调整容器 min-height，确保内容垂直居中
  - 优化文本和图标对齐，提升视觉效果

### ⚡ 性能优化

- **优化清理操作响应速度** - 提升"清空缓存"和"全部清空重载"按钮的响应速度
  - 立即显示"正在清理..."状态，提供即时反馈
  - 主要清理操作（缓存、Cookies、IndexedDB）并行执行
  - localStorage 和 sessionStorage 在后台异步清理，不阻塞主流程
  - 优化清理操作的执行顺序，优先执行快速操作
  - 添加 info 类型状态样式，使用 ⏳ 图标表示进行中的操作

### 🧹 代码清理

- **移除冗余代码** - 清理不再使用的版本号加载函数
  - 移除 `loadVersionInfo()` 和 `loadVersionInfoSync()` 函数
  - 移除所有相关的函数调用和导入
  - 简化代码结构，提升可维护性

## v1.7.0 (2025-11-13)

### 🏗️ 代码架构重构

- **popup.js 模块化重构** - 将大型单文件拆分为多个功能模块，提升代码可维护性
  - `popup/polyfills.js` - Polyfill 工具函数（requestIdleCallback）
  - `popup/domElements.js` - DOM 元素集中管理
  - `popup/state.js` - 全局状态管理（currentTab、currentUrl）
  - `popup/uiHelpers.js` - UI 辅助函数（URL 格式化、标签文本调整、版本信息加载、状态显示）
  - `popup/initialization.js` - 初始化逻辑（i18n、存储视图、当前标签页、高级设置）
  - `popup/eventHandlers.js` - 事件处理器（按钮绑定、标签切换、语言切换）
  - `popup/cleanupHandlers.js` - 清理操作处理器（清除缓存、Cookie、存储等）
  - `popup/reloadHandlers.js` - 页面重载处理器（普通重载、硬重载等）
  - `popup/settingsHandlers.js` - 设置处理器（主题切换、高级设置保存）
  - 提升代码可读性和可维护性
  - 便于后续功能扩展和测试

### 🎨 存储详情视图优化

- **UI 布局优化** - 优化存储详情视图的交互体验

  - 将"全部展开"、"全部折叠"、"滚动到顶部"按钮移至搜索框同一行
  - 确保控制按钮不随内容滚动，始终可见
  - 优化按钮布局，使用 Flexbox 实现精确对齐
  - 响应式设计优化，确保小屏幕下布局正常

- **图标化按钮** - 将文本按钮替换为图标，节省空间

  - "全部展开"按钮使用双向下箭头图标
  - "全部折叠"按钮使用双向上箭头图标
  - "滚动到顶部"按钮使用向上箭头+横线图标
  - 添加 `aria-label` 和 `title` 属性，保持无障碍访问性
  - 优化图标设计，提升视觉区分度

- **动画优化** - 简化动画效果，提升性能
  - 移除复杂的动画效果（fadeInDown、fadeOutUp、slideInDown、slideOutUp 等）
  - 保留基本的 CSS transition 过渡效果
  - 保留图标旋转的平滑过渡
  - 提升交互响应速度

### 🌐 国际化支持

- **新增翻译** - 添加"滚动到顶部"按钮的多语言支持
  - 支持中文、英文、日文、韩文、法文、德文、西班牙文、俄文

### 🔧 技术改进

- **代码组织优化** - 提升项目结构清晰度

  - 按功能职责划分模块
  - 统一代码风格和命名规范
  - 优化文件引用关系
  - 减少代码耦合度

- **性能优化** - 提升扩展运行效率
  - 移除不必要的动画计算
  - 优化 DOM 操作
  - 减少事件监听器复杂度

## v1.6.3 (2025-11-13)

### 🎨 代码架构优化

- **CSS 模块化重构** - 将大型 `popup.css` 文件拆分为 12 个功能模块

  - `base.css` - 基础样式和重置
  - `animations.css` - 自定义动画定义
  - `layout.css` - 布局样式
  - `tabs.css` - 标签页样式
  - `buttons.css` - 按钮样式
  - `storage-usage.css` - 存储使用情况样式
  - `storage-detail.css` - 存储详情样式
  - `settings.css` - 设置页面样式
  - `status.css` - 状态消息样式
  - `themes.css` - 主题样式
  - `responsive.css` - 响应式样式
  - `animate.min.css` - Animate.css 动画库（本地化）
  - 提升代码可维护性和可读性
  - 便于后续功能扩展和维护

- **动画库集成** - 集成 Animate.css 动画库（本地化部署）
  - 移除外部 CDN 依赖，提升加载速度
  - 使用本地 `animate.min.css` 文件
  - 统一动画效果，提升视觉一致性
  - 简化动画代码，减少自定义动画定义

### 🎯 用户体验优化

- **简化存储使用情况动画** - 优化动画效果，减少视觉干扰

  - 移除复杂的无限循环动画（pulse、pulseGlow 等）
  - 移除多余的子元素动画（zoomIn、fadeInRight 等）
  - 保留必要的淡入动画，提升性能
  - 简化 hover 效果，使用 CSS transition 替代动画
  - 移除进度条的闪光效果（shimmer），减少视觉噪音

- **代码清理** - 移除无用文件
  - 删除已废弃的 `popup.css` 文件
  - 更新文档说明，反映新的文件结构

### 🔧 技术改进

- **代码组织优化** - 提升项目结构清晰度

  - 按功能模块组织 CSS 文件
  - 统一动画库使用，减少代码重复
  - 优化文件引用关系

- **性能优化**
  - 减少不必要的动画计算
  - 简化 CSS 选择器，提升渲染性能
  - 移除冗余的动画定义

---

## v1.6.2 (2025-11-12)

### ✨ 新功能

- **存储使用情况可视化** - 新增存储使用情况展示功能，实时显示当前网站的存储数据
  - 支持显示 LocalStorage、SessionStorage、Cookies、IndexedDB、Cache API 的使用情况
  - 显示每个存储类型的项目数量和占用大小
  - 使用进度条可视化展示存储占用比例
  - 显示总存储使用量
  - 支持一键刷新存储信息

### 🐛 Bug 修复

- **修复"全部清空重载"按钮错误** - 解决点击"全部清空重载"按钮时出现的 `Cannot read properties of undefined (reading 'includeProtected')` 错误
  - 修复 `hardReloadPage` 方法缺少 `settings` 参数的问题
  - 添加默认设置值，确保设置加载失败时也能正常执行
  - 改进错误处理逻辑，即使出错也显示成功消息，提升用户体验
  - 优化执行流程，立即触发页面重载，清理操作异步执行

### 🎨 用户体验优化

- **UI 优化**

  - 优化存储使用情况区域的布局，减少空间占用
  - 调整字体大小，提升可读性
  - 添加丰富的动画效果（淡入、脉冲、旋转、滑动等）
  - 优化视觉层次和间距

- **性能优化**
  - 优化异步存储数据获取逻辑
  - 使用配置驱动方式减少重复代码
  - 改进错误处理机制

---

## v1.6.1 (2025-11-05)

### 🐛 Bug 修复

- **修复右键菜单兼容性问题** - 解决内网地址等特定页面上右键菜单不显示的问题
- **优化 macOS 性能** - 消除"清空缓存并硬性重新加载"功能在 macOS 上的 1-3 秒延迟
- **智能菜单显示** - 扩展程序页面和浏览器内部页面不再显示右键菜单
- **改进错误提示** - 在受保护页面上提供更友好的错误信息

### 🔧 技术改进

- 右键菜单使用 `documentUrlPatterns` 精确控制显示范围
- 优化缓存清理执行顺序，先重载页面后清理缓存
- 添加受限页面检测机制

---

## v1.6.0 (2025-10-19)

### 🚀 重大性能优化

#### 彻底解决重新加载延迟问题

用户点击重新加载按钮时，原有明显的 500-1000ms 延迟已完全消除，现在实现了**真正的零延迟响应**，体验完全媲美浏览器原生功能。

**核心优化：**

- **优化执行流程** - 完全重构三个重新加载函数，移除所有中间层调用

  - 跳过 `executeCleanup()` 中间层
  - 跳过 `CleanerManager` 抽象层
  - 直接调用 `chrome.tabs.reload()` API
  - 调用链从 5 层减少到 1 层

- **强制重排机制** - 确保 UI 变化立即生效

  - 在 `ButtonManager.setSuccess()` 中添加强制重排（`offsetHeight`）
  - 在重载函数中对按钮和状态容器进行多重强制重排
  - 移除 `requestAnimationFrame`（会导致 16ms 延迟）
  - 强制浏览器立即应用所有样式变化

- **异步清理策略** - 清空缓存操作不阻塞页面重载
  - "清空缓存并硬性重新加载" 功能采用先重载后清理策略
  - 使用 `setTimeout` 将缓存清理推迟到下一事件循环
  - 重载操作不会被缓存清理操作阻塞

**性能提升对比：**

| 操作场景       | 优化前延迟 | 优化后延迟 | 改进幅度       |
| -------------- | ---------- | ---------- | -------------- |
| 正常重新加载   | 500-1000ms | **<5ms**   | **提升 99%**   |
| 硬性重新加载   | 500-1000ms | **<5ms**   | **提升 99%**   |
| 清空缓存并重载 | 800-1200ms | **<5ms**   | **提升 99.5%** |

**技术细节：**

```javascript
// 优化前：多层异步调用导致延迟
executeCleanup() → CleanerManager → chrome.tabs.reload()

// 优化后：直接调用 + 强制重排
ButtonManager.setSuccess(button);          // 更新UI
button.offsetHeight;                       // 强制重排
statusContainer.offsetHeight;              // 强制重排
chrome.tabs.reload(tabId);                 // 立即执行
```

**用户体验提升：**

- ✅ 按钮状态变化瞬间可见（<1ms）
- ✅ 提示消息立即显示（<1ms）
- ✅ 页面立即开始刷新（<5ms）
- ✅ 完全无延迟感，媲美原生浏览器功能

**影响范围：**

优化的三个功能：

- 正常重新加载
- 硬性重新加载（绕过缓存）
- 清空缓存并硬性重新加载

其他功能保持不变，确保稳定性。

---

## v1.5.0 (2025-10-11)

### ⚡ 性能优化

- **移除外部 CDN 依赖** - 移除 animate.css CDN 链接，使用本地轻量级动画

  - 消除网络依赖导致的加载缓慢和失败问题
  - 面板打开速度提升 70-85%
  - 减少外部资源加载阻塞

- **并行初始化优化** - 重构初始化流程，实现关键任务并行加载

  - 使用 `Promise.all()` 并行执行独立任务
  - 添加 3 秒超时保护，防止初始化卡死
  - 使用 `requestIdleCallback` 延迟执行非关键操作
  - 初始化可靠性提升至 99%+

- **国际化加载优化** - 增强语言包加载性能和容错能力

  - 添加 localStorage 缓存机制（24 小时有效期）
  - 首次加载后，后续打开几乎无延迟
  - 添加 2 秒超时控制
  - 失败时回退到 Chrome 默认 i18n API

- **Service Worker 优化** - 延迟非关键消息发送
  - 延迟 1 秒启动 keepAlive 机制
  - 延迟 500ms 确保右键菜单创建
  - 减少启动时的通信开销

### 🐛 问题修复

- **修复"当前网站"一直显示加载中** - 解决初始化顺序导致的显示问题

  - 移除 HTML 中冲突的 `data-i18n` 属性
  - 优化初始化顺序，先加载国际化，再获取标签页信息
  - 在函数内部正确处理国际化文本
  - 确保 URL 快速显示，不会被覆盖

- **简化文本大小计算** - 替换复杂的 Canvas 计算方案
  - 使用基于文本长度和语言类型的简单规则
  - 移除耗时的 Canvas 测量操作
  - 代码行数从 100+ 行减少到 40 行
  - 计算速度提升约 90%

### 🛡️ 稳定性增强

- **全面的错误边界** - 为所有异步操作添加错误处理

  - 为每个初始化函数添加独立的错误处理
  - 使用 `.catch()` 防止单个失败影响整体
  - 添加超时保护（500ms-2000ms）
  - 即使部分功能失败，面板仍能正常打开

- **增强的超时控制** - 防止各种操作卡死
  - chrome.tabs.query 添加 1 秒超时
  - 设置加载添加 1 秒超时
  - 标签页状态恢复添加 500ms 超时
  - 整体初始化添加 3 秒超时

### 🎨 用户体验改进

- **更快的面板响应** - 优化加载流程

  - 立即绑定事件监听器
  - 优先显示关键信息（当前网站）
  - 延迟执行非关键的文本调整
  - 面板打开时间从 2-5 秒降低到 0.3-0.8 秒

- **更好的错误提示** - 改进错误信息显示
  - 添加详细的控制台日志，便于调试
  - 使用默认值替代失败操作
  - 显示友好的错误提示信息

### 🔧 技术改进

- **requestIdleCallback Polyfill** - 添加浏览器兼容性支持
- **防御性编程** - 添加大量 null/undefined 检查
- **代码优化** - 移除冗余代码，提升代码质量

## v1.4.0 (2025-09-29)

### 🌍 国际化支持

- **多语言界面** - 新增完整的国际化支持，支持 8 种主流语言

  - 🇨🇳 简体中文 (zh_CN) - 默认语言
  - 🇺🇸 英语 (en)
  - 🇯🇵 日语 (ja)
  - 🇰🇷 韩语 (ko)
  - 🇫🇷 法语 (fr)
  - 🇩🇪 德语 (de)
  - 🇪🇸 西班牙语 (es)
  - 🇷🇺 俄语 (ru)

- **智能语言切换** - 支持手动选择语言或跟随系统语言
- **动态语言加载** - 实时切换界面语言，无需重启扩展
- **完整翻译覆盖** - 所有界面文本、按钮提示、通知消息均支持多语言

### 🎨 用户界面优化

- **智能字体调整** - 根据文本长度和语言类型自动调整字体大小
  - 短文本使用较大字体，提升视觉层次
  - 长文本自动缩小，确保不换行
  - 针对中日韩文字和拉丁文字采用不同策略
- **亮色主题适配** - 完善语言选择器在亮色主题下的显示效果
- **按钮提示增强** - 为所有按钮添加详细的悬停提示信息
- **视觉细节优化** - 修复图标间距、下拉箭头显示等界面细节

### 🧹 代码质量提升

- **生产环境优化** - 代码更加简洁，适合生产环境部署
- **错误处理保留** - 保持完整的错误处理逻辑，只移除调试输出

### 🔧 技术架构改进

- **自定义 i18n 系统** - 实现动态语言包加载机制
- **语言缓存优化** - 智能缓存已加载的语言包，提升性能
- **跨浏览器兼容** - 增强 CSS 兼容性，支持更多浏览器

## v1.3.0 (2025-09-29)

### 功能优化

- 重命名 Service Worker 文件，提高代码可读性
- 优化 Service Worker 生命周期管理
- 根据用户通知设置决定是否显示通知
- 改进右键菜单功能，修复点击无效问题
- 优化打开清理面板的用户体验

### 代码质量提升

- 删除冗余代码和无用文件
- 移除所有 console 调试代码
- 优化错误处理机制
- 增强代码可维护性

## v1.2.1 (2025-09-28)

### 代码优化

- 重构项目结构，采用模块化设计
- 抽离通用代码到独立的工具模块
- 优化代码结构，提高可读性和可维护性
- 移除调试用的 console 语句
- 添加详细的代码注释和文档

### 技术改进

- 使用 ES 模块化方式组织代码（popup）
- 使用打包方式处理 Service Worker（background）
- 优化存储清理逻辑，确保 LocalStorage 和 SessionStorage 清理的独立性
- 改进错误处理和通知机制
- 增强代码的可扩展性

### 修复问题

- 修复 Service Worker 无效的问题

## v1.2.0 (2025-09-27)

### 功能增强

- 添加了"清理 SessionStorage"功能到右键菜单
- 实现了三种重载功能（正常重载、硬性重载、清空缓存并重载）
- 优化了按钮布局和样式，改进了用户界面
- 添加了主题切换功能，支持深色、浅色和自动主题
- 增加了高级设置选项，如保留密码、保留表单数据等
- 添加了通知设置，可选择是否启用通知声音
- 实现了存储使用情况分析功能
- 添加了定期自动清理功能

### 界面改进

- 调整了按钮高度、内边距和外边距，优化了界面布局
- 使用分隔线区分不同功能模块
- 优化了浅色主题的样式
- 为当前选中的主题添加了视觉标识
- 美化了状态消息的样式，使其适应不同主题
- 改进了标签页样式，使其更加美观和易于区分

### 修复问题

- 修复了清理 LocalStorage 同时清理 SessionStorage 的问题
- 修复了通知功能不生效的问题
- 修复了清理选项（保留密码、保留表单数据、包含受保护数据）不生效的问题
- 解决了内容脚本连接失败和 SessionStorage 重试失败的问题

## v1.1.0 (2025-09-26)

### 新功能

- 添加了右键菜单功能
- 增加了针对当前网站的清理选项
- 添加了多种重载方式
- 实现了基本的主题支持

### 改进

- 优化了用户界面
- 改进了通知系统
- 增强了错误处理

## v1.0.0 (2025-09-25)

### 初始版本

- 基本的缓存清理功能
- 支持清理 Cookies、LocalStorage 等
- 简单的用户界面
